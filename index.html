<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1502.6667 1614.6667"
  height="800" width="600" xml:space="preserve" id="bubble" version="1.1"><metadata
     id="metadata8"><rdf:RDF><cc:Work
         rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" /></cc:Work></rdf:RDF></metadata><defs
     id="defs6">
  <clipPath
       id="clipPath18"
       clipPathUnits="userSpaceOnUse"><path
         id="path16"
         d="M 0,1211 H 1127 V 0 H 0 Z" /></clipPath></defs><g
     transform="matrix(1.3333333,0,0,-1.3333333,0,1614.6667)"
     id="g10"><g
       id="g12"><g
         clip-path="url(#clipPath18)"
         id="g14"><g
           transform="translate(108.8418,1137.9395)"
           id="g20"><path
             id="path22"
             style="fill:none;stroke:#000000;stroke-width:46.93799973;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
             d="m 0,0 h 905.987 c 23.006,0 41.679,-18.604 41.765,-41.609 l -0.147,-721.928 c -0.004,-23.193 -18.648,-42.076 -41.839,-42.376 l -250.893,0.501 c -12.6,0.026 -24.557,-5.555 -32.63,-15.228 0,0 -107.665,-133.367 -144.003,-178.897 -13.037,-16.334 -37.662,-16.688 -50.436,-0.149 -33.745,43.693 -145.576,174.772 -145.576,174.772 -8.055,10.429 -20.502,16.518 -33.679,16.478 L 0.131,-809.235 c -23.461,-0.073 -42.519,18.926 -42.519,42.387 v 724.46 C -42.388,-18.978 -23.41,0 0,0 Z" /></g><g
           transform="translate(285.4504,600)"
           id="g40"><path
             id="bar1"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g><g
           transform="translate(400.0486,600)"
           id="g36"><path
             id="bar2"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g><g
           transform="translate(514.647,600)"
           id="g32"><path
             id="bar3"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g><g
           transform="translate(629.2451,600)"
           id="g28"><path
             id="bar4"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g><g
           transform="translate(743.8435,600)"
           id="g24"><path
             id="bar5"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g><g
           transform="translate(858.4417,600)"
           id="g44"><path
             id="bar6"
             style="fill:#ef8336;fill-opacity:1;fill-rule:nonzero;stroke:none"
             d="m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v 10 c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0" /></g></g></g></g></svg>

<script>
  /*
2c6873
f2be45
ef8336
eb4358
51b1ca
*/

const context = new AudioContext();
const analyser = context.createAnalyser();

analyser.fftSize = 1024;

const data = new Uint8Array(analyser.frequencyBinCount);

navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;

navigator.getUserMedia({ audio: true }, onStream, onStreamError);

// due to browser policy, we must start the audio context from a user-initiated action
document.onclick = () => context.resume();

function onStream(stream) {
  const source = context.createMediaStreamSource(stream);
  source.connect(analyser);
  
  visualize();
}

function onStreamError(e) {
  document.body.innerHTML = "<h1>This pen only works with https://</h1>";
  console.error(e);
}

const render = () => {
  // the range of frequencies that we are visualising
  const range = 64;
  
  // the number of frequencies represented by each bar
  const interval = range / 6;
  
  // how easily the bars reach maximum height
  const sensitivity = 2;
  
  // min height of bars (not including curves)
  const min = 10;
  
  // max height of bars (not including curves)
  const max = 480;
  
  for (let channel = 1; channel < 7; channel++) {
    const to = Math.floor(interval * channel);
    const from = Math.ceil(to - interval);
    const segment = data.slice(from, to);
    const sum = segment.reduce((a, b) => a + b);
    const average = sum / segment.length;
    let height = sensitivity * average;
    let translateY = -average * 0.8;
    
    // scale down first and last channels to achieve an 'eyes' aesthetic
    if (channel === 1 || channel === 6) {
      translateY *= 0.2;
      height *= 0.2;
    }
    
    height = Math.max(min, Math.min(max, height));

    const bar = document.getElementById("bar" + channel);
    
    // louder frequencies render with a greater height
    bar.setAttribute(
      "d",
      `m 0,0 h -11.941 c -14.938,0 -27.048,12.11 -27.048,27.048 v ${height} c 0,14.938 12.11,27.048 27.048,27.048 H 0 c 14.938,0 27.048,-12.11 27.048,-27.048 V 27.048 C 27.048,12.11 14.938,0 0,0`
    );
    
    // louder frequencies are shifted down further
    bar.setAttribute('transform', `translate(0, ${translateY})`);
  }
};

function visualize() {
  requestAnimationFrame(visualize);
  
  analyser.getByteFrequencyData(data);

  render();
}

</script>
